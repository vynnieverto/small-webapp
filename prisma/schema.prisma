// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init


generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

enum Role {
  TOP
  JUNGLE
  MID
  BOT
  SUPPORT
}

enum ObjectiveType {
  DRAGON
  BARON
  RIFT
  TOWER
  INHIBITOR
  VOIDGRUBS
}


model User {
  id        String @id @default(cuid())
  username      String
  email     String? @unique
  password  String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  Role      String
  Player    Player[]
  
}


model Player {
  puuid       String @id
  gameName    String 
  tagLine         String
  Participant Participant[]
  Region      String? 
  Mastery    Mastery[]
  User        User? @relation(fields: [userId], references: [id])
  userId      String?
  @@unique([gameName, tagLine])

}

// May need to make changes to this model
model Match {
  MatchId         String @id
  StartTime  DateTime @default(now())
  Duration  Int
  GameMode  String
  MapID     Int
  GameType  String

  Participants Participant[]
  Teams        Team[]
}

model Participant {
  MatchId         String
  puuid           String
  participantId    Int
  championId            Int
  teamId               Int
  role                 Role
  lane                 String
  kills                Int
  deaths              Int
  assists             Int
  goldEarned          Int
  goldSpent           Int
  totalDamageDealt    Int
  totalDamageTaken    Int
  wardsPlaced         Int
  wardsKilled         Int

  @@id([MatchId, puuid])
  Player Player @relation(fields: [puuid], references: [puuid])
  Match Match @relation(fields: [MatchId], references: [MatchId]) 
  Team Team @relation(fields: [MatchId, teamId], references: [MatchId, teamId])
}


model Team {
  teamId               Int
  MatchId             String
  teamPosition        String
  win                 Boolean
  firstBlood          Boolean
  firstTower         Boolean
  firstInhibitor      Boolean
  firstBaron          Boolean
  Match Match @relation(fields: [MatchId], references: [MatchId])
  Participants Participant[]
  Objectives Objective[]
  @@id([MatchId, teamId])
}

model Objective {
  MatchId             String
  teamId               Int
  type                ObjectiveType
  kills               Int
  timeAlive           Int
  timeAlivePercent    Float
  Team Team @relation(fields: [MatchId, teamId], references: [MatchId, teamId])
  @@id([MatchId, teamId, type])
}

model Mastery {
  championId            Int
  playerId              String 
  championLevel         Int
  championPoints        Int
  totalLevelPoints      Int
  pointsUntilNextLevel  Int
  @@id([championId, playerId])
  Player Player @relation(fields: [playerId], references: [puuid])
}
